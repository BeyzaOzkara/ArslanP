{% extends 'adminlte/base.html' %}
{% block body_class %}{% block bodyclass %}sidebar-collapse {% endblock %}{% endblock %}

{% load static %}

{% block title %}Üretim - Kart Bölüştürme{% endblock %}

{% block stylesheets %}
{% include 'adminlte/lib/_styles.html' %}
<style>

</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="profilDiv">
        <label for="profilSelect">Profil Numarası Seçiniz: </label>
        <select name="profil" id="profilSelect" class="form-control">
            <option value="" disabled selected>Profil No</option>
            {% for p in profils %}
            <option value={{p}}>{{p}}</option>
            {% endfor %}
        </select>
    </div>
    <div class="extDiv col-6" style="display: none;">
        <p>dddd</p>
        <div id="extTable"></div>
    </div>
    <div class="sepetDiv col-6" style="display: none;">
        <div id="sepetTable"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    var profilSelect = document.getElementById('profilSelect');
    var extDiv = document.getElementById('extTable');
    var sepetDiv = document.getElementById('sepetTable');
    
    profilSelect.addEventListener("change",function () {
        var selectedProfilNo = this.value;
        $.ajax({
            url: '/4500/hesaplama/get_ext_info/',
            type: 'GET',
            data: {
                profil_no: selectedProfilNo
            },
            success: function (response) {
                console.log(response.ext_data);
            },
            error: function (xhr, status, error) {
                console.error("Error fetching Ext info:", error);
            }
        });
        
        $.ajax({
            url: '/4500/hesaplama/get_sepet_info/',
            type: 'GET',
            data: {
                profil_no: selectedProfilNo
            },
            success: function (response) {
                console.log(response.sepet_data)
            },
            error: function (xhr, status, error) {
                console.error("Error fetching Ext info:", error);
            }
        });
    
    });

    function initializeExtTabulator(data) {
        table = new Tabulator("#extTable", {
            height: "250px",
            layout:"fitColumns",
            placeholder: "Ext Geçmişi",
            data: JSON.parse(data || '[]'), // Initialize with existing yuklenen data, or empty data if none
            columns: [
                { title: "KartNo", field: "kart_no" },
                { title: "Kalıp No", field: "kalip_no" },
            ]
        });
    };

    function initializeSepetTabulator(data) {
        table = new Tabulator("#sepetTable", {
            height: "250px",
            layout:"fitColumns",
            placeholder: "Sepetler",
            data: JSON.parse(data || '[]'), // Initialize with existing yuklenen data, or empty data if none
            columns: [
                { title: "Sepet No", field: "SepetNo" },
                { title: "Profil No", field: "ProfilNo" },
                { title: "Adet", field: "Adet" },
            ]
        });
    }


});
</script>

{% endblock %}

{% block javascript %}
{% include 'adminlte/lib/_scripts.html' %}

{% endblock %}