{% extends 'adminlte/base.html' %}
{% block body_class %}{% block bodyclass %}sidebar-collapse {% endblock %}{% endblock %}

{% load static %}

{% block title %}Arslan Alüminyum{% endblock %}

{% block stylesheets %}
{% include 'adminlte/lib/_styles.html' %}
<link rel="stylesheet" type="text/css" href="{% static 'tabulator/dist/css/tabulator_bootstrap5.min.css' %}">

<style>
    .tabulator .tabulator-row .tabulator-cell[tabulator-field="Kg"]{
        font-weight: bold;
        color:rgb(0, 38, 255);
    }
</style>

{% endblock %}

{% block content %}

<div class="container-fluid col-lg-11">
    <h1 class="col-lg-11">Arslan Alüminyum Sipariş Listesi</h1>
    <div class="card" id="siparisList-table"></div>
    <!-- row 1 -->
</div> 
<!-- cont 1 -->

{% endblock %}

{% block extra_js %}


<script>

//var sip = JSON.parse('{{ sipData|escapejs }}');

    var table = new Tabulator("#siparisList-table", {
        height: "100%",
        layout: "fitDataFill",
        columnDefaults: {resizable: true,},
        ajaxURL:"/siparis/list",
        locale:true,
        langs:{
            "tr":{
                "data":{
                    "loading":"Yükleniyor", //data loader text
                    "error":"Hata", //data error text
                },
                "pagination":{
                    "first":"İlk",
                    "first_title":"İlk Sayfa",
                    "last":"Son",
                    "last_title":"Son Sayfa",
                    "prev":"Önceki",
                    "prev_title":"Önceki Sayfa",
                    "next":"Sonraki",
                    "next_title":"Sonraki Sayfa",
                    "all":"Hepsi",
                    "page_size":"Sayı",
                },
            },
        },
        //progressiveLoad:"scroll",
        filterMode:"remote",
        pagination:true,
        paginationMode:"remote",
        paginationInitialPage:1,
        paginationSize:15,
        paginationSizeSelector:[15, 30, 60, 100],
        dataTree: true,
        ajaxURLGenerator:function(url, config, params){
            return url + "?params=" + encodeURI(JSON.stringify(params)); //encode parameters as a json object
        },
        columns: [
            { title: "Sip Tamam", field: "SiparisTamam", headerFilter: "input"},
            { title: "Kart No", field: "KartNo", headerFilter: "input"},
            { title: "Firma Adı", field: "FirmaAdi", headerFilter: "input"},
            { title: "Profil No", field: "ProfilNo", headerFilter: "input"},
            { title: "Pres Kodu", field: "PresKodu", headerFilter: "input"},
            { title: "Kondüsyon", field: "KondusyonTuru", headerFilter: "input"},
            { title: "Sipariş Kg", field: "GirenKg", headerFilter: "input", formatter:"money", formatterParams:{decimal:",",thousand:".",symbol: " kg",symbolAfter:" kg",negativeSign:false,} },
            { title: "Kalan Kg", field: "Kg", headerFilter: "input", formatter:"money", formatterParams:{decimal:",",thousand:".",symbol: " kg",symbolAfter:" kg",negativeSign:false,} },
            { title: "Kalıp", field: "kalipSayisi"},
            { title: "Kalan Tenifer", field: "TopTenKg", formatter:"money", formatterParams:{decimal:",",thousand:".",symbol: " kg",symbolAfter:" kg",negativeSign:false,}},
        ],
        rowFormatter: function (row) {
            var holderEl = document.createElement("div");
            var tableEl = document.createElement("div");

            holderEl.style.boxSizing = "border-box";
            holderEl.style.padding = "10px 30px 10px 10px";
            holderEl.style.borderTop = "1px solid #333";
            holderEl.style.borderBotom = "1px solid #333";
            tableEl.style.border = "1px solid #333";
            //run code after data has been updated
            
            row.getElement().appendChild(holderEl);
            holderEl.appendChild(tableEl);

            row.getElement().addEventListener("click", function(){
                if(!row.getTreeParent()){
                    if(row.isTreeExpanded()){
                        row.treeCollapse();
                        console.log("if");
                    } else {
                        
                        console.log(row.getData().children);
                        var subTableURL = "child/" + row.getData().ProfilNo;
                        if(row.getData().children==true){
                            $.ajax({
                                url:subTableURL,
                                dataType: "json",
                                success: function(subTableData){
                                    row.update({ children: subTableData})
                                        .then(function(){
                                            //run code after data has been updated
                                            var subTable = new Tabulator(tableEl, {
                                                data: subTableData,
                                                layout: "fitColumns",
                                                dataType:"json",
                                                columns: [
                                                    { title: "Kalıp No", field: "KalipNo", headerSort: false },
                                                    { title: "Pres Kodu", field: "PresKodu", headerSort: false},
                                                    { title: "Ø", field: "Capi", headerSort: false},
                                                    { title: "Son Basılan", field: "SonPresKodu", headerSort: false},
                                                    { title: "Üretici", field: "UreticiFirma", headerSort: false },
                                                    { title: "Kalan Ten Ömrü", field: "TeniferKalanOmurKg", headerSort: false, formatter:"money", formatterParams:{decimal:",",thousand:".",symbol: " kg",symbolAfter:" kg",negativeSign:false,}  },
                                                    { title: "Toplam Uretim", field: "UretimToplamKg", headerSort: false, formatter:"money", formatterParams:{decimal:",",thousand:".",symbol: " kg",symbolAfter:" kg",negativeSign:false,}  },
                                                    { title: "Konum", field: "Konum", headerSort: false, formatter:"html"},
                                                ],
                                            });

                                        });

                            }   })}
                            
                        else{
                            console.log("else");
                            //$("#subTable" + row.getData().ProfilNo + "").toggle();
                            };
                        }
                    }
            })
            
        },
    });
           

</script>


{% endblock %}

{% block javascript %}
{% include 'adminlte/lib/_scripts.html' %}
<script src="{% static 'tabulator/dist/js/tabulator.js' %} "></script>

<!-- indirmek zorunda kalmayacağımız bir yolunu bul -->
{% endblock %}