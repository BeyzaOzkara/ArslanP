{% extends 'adminlte/base.html' %}

{% block body_class %}
  {% block bodyclass %}
    sidebar-collapse
  {% endblock %}
{% endblock %}

{% load static %}

{% block title %}
  Arslan Alüminyum
{% endblock %}

{% block stylesheets %}
  {% include 'adminlte/lib/_styles.html' %}
  <link rel="stylesheet" type="text/css" href="{% static 'tabulator/dist/css/tabulator_bootstrap5.min.css' %}">

  <style>
    /* Ana Container Stili */
    #goz-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
    }

    /* Göz Kartı Stili */
    .goz-card {
    border: 1px solid #ddd;
    padding: 20px;
    margin-bottom: 20px;
    }

    /* Kalıp Kutusu Stili */
    .kalip-box {
    padding: 10px;
    border: 1px solid #ccc;
    margin: 10px 0;
    background-color: #f9f9f9;
    }

    /* Media Queries */
    @media (max-width: 600px) {
    #goz-container {
        flex-direction: column;
    }
    }
  </style>
{% endblock %}

{% block content %}
<div class="container" id="goz-container"></div>

<div class="row cards-row" id="cardsRow">
    <div class="card" style="width: 100%; min-width: 800px; height: 100%; min-height: 600px;">
        <div class="card-body" id="gozParent" style="width: 100%; height: 100%; overflow-y: scroll;">
            <div class="d-flex bd-highlight mb-3">
                <div class="card" style="width: 100%; height: 100%;">
                    <div class="card-body">
                        <div class="row row-cols-2">
                                
                            <div class="col-lg-1">
                                <h3>1. GÖZ</h3>
                            </div>
                            <div class="col-lg-11">
                                <div class="row">
                                    <div class="col-lg-4 info-box bg-light">
                                        <div class="info-box-content">
                                        <span class="info-box-text text-center text-muted">Estimated budget</span>
                                        <span class="info-box-number text-center text-muted mb-0">2300</span>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 info-box bg-light">
                                        <div class="info-box-content">
                                        <span class="info-box-text text-center text-muted">Estimated budget</span>
                                        <span class="info-box-number text-center text-muted mb-0">2300</span>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 info-box bg-light">
                                        <div class="info-box-content">
                                        <span class="info-box-text text-center text-muted">Estimated budget</span>
                                        <span class="info-box-number text-center text-muted mb-0">2300</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                
                

            </div>
           
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}

<script>
    const renderData = (data) => {
        // Her bir göz için bir grup oluşturacak olan obje
        const gozMap = {};
        
        // Veri üzerinde dönerek her bir item'ı işle
        data.forEach(item => {
            // Eğer item'ın bir 'locationName' değeri varsa işleme al
            if (item.kalipVaris__locationName) {
                // Eğer bu göz için bir grup yoksa yeni bir grup oluştur
                if (!gozMap[item.kalipVaris__locationName]) {
                    gozMap[item.kalipVaris__locationName] = [];
                }
                // Mevcut göz grubuna yeni bir kalıp ekler
                gozMap[item.kalipVaris__locationName].push(item);
            }
        });

        // Container elemanını seç
        const container = document.getElementById('goz-container');
        
        // Oluşturulan gruplar üzerinde dön
        for (const [goz, kalipList] of Object.entries(gozMap)) {
            // Her göz için bir kart oluştur
            const gozCard = document.createElement('div');
            gozCard.className = 'goz-card';
            gozCard.innerHTML = `<h3>${goz}</h3>`; // Kartın başlığını belirle
            
            // Her kart için kalıpları içeren elemanları oluştur
            kalipList.forEach(kalip => {
            const kalipBox = document.createElement('div');
            kalipBox.className = 'kalip-box';
            kalipBox.innerText = `Kalıp No: ${kalip.kalipNo}`;
            gozCard.appendChild(kalipBox); // Her bir kalıp kutusunu kart içine ekle
            });

            container.appendChild(gozCard); // Oluşturulan kartı ana konteynere ekle
        }
    }

    const loadPage = () => {
        $.ajax({
        url: `/kalipfirini/goz`,
        method: 'GET',
        dataType: 'json',
        success: function (data) {
            if (data.length !=0){
                data = JSON.parse(data);
                renderData(data);
            }
        },
        error: function (data) {
            alert(data.responseJSON.error);
        }
        });
    };

    loadPage();
</script>

{% endblock %}

{% block javascript %}
  {% include 'adminlte/lib/_scripts.html' %}
  <script src="{% static 'tabulator/dist/js/tabulator.js' %} "></script>

{% endblock %}