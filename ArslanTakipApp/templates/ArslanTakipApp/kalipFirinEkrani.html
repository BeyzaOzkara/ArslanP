{% extends 'adminlte/base.html' %}

{% block body_class %}
  {% block bodyclass %}
    sidebar-collapse
  {% endblock %}
{% endblock %}

{% load static %}

{% block title %}
  Arslan Alüminyum
{% endblock %}

{% block stylesheets %}
  {% include 'adminlte/lib/_styles.html' %}
  <link rel="stylesheet" type="text/css" href="{% static 'tabulator/dist/css/tabulator_bootstrap5.min.css' %}">

  <style>
 
  </style>
{% endblock %}

{% block content %}
<div class="container mt-3">
    {% for goz in gozData %}
        <!-- Göz kartı -->
        <div class="card mb-3">
            <div class="card-header">
                {{ goz.locationName }} <!-- Göz ismi -->
            </div>
            <div class="card-body">
                <!-- Kalıplar için grid yapısı -->
                <div class="row">
                    {% for kalip in goz.kalıplar %}
                        <div class="col-md-4 col-sm-6">
                            <!-- Info box -->
                            <div class="info-box">
                                <!-- <span class="info-box-icon bg-info" style="position: relative; display: flex; align-items: center; justify-content: center;">
                                    
                                </span> -->
                                <div class="info-box-content">
                                    <div class="row">
                                        <div class="container col-lg-6">
                                          <span class="info-box-text" style="font-size: 3.7vh; text-align:center;">{{ kalip.kalipNo }}</span>
                                        </div>
                                        <div class="container col-lg-6" style= "margin-top:auto; margin-bottom:auto; display: flex; justify-content: center;">
                                            <div class="timer"  data-hareket-tarihi="{{ kalip.hareketTarihi }}" style="width: 100px; height: 100px;" id="timer-{{ forloop.parentloop.counter }}-{{ forloop.counter }}">
                                                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                                                    <circle cx="50" cy="50" stroke="#800" stroke-width="4" r="45" fill="grey" />
                                                    <path class="halfC" d="M 50 5 L 50 50 A 45 45 0 0 1 95 50 Z" fill="green" fill-opacity="0"></path>
                                                    <circle class="warnC" cx="50" cy="50" r="45" fill="red" fill-opacity="0"></circle>
                                                    <!-- Ensure the text is centered within the circle -->
                                                    <text class="base-timer__label" x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="3.8vh" fill="white">00:00</text>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endfor %}
</div>

{% endblock %}

{% block extra_js %}

<script>
document.addEventListener("DOMContentLoaded", function() {
    const TIME_LIMIT = 86400; // 24 hours in seconds, used to determine when to change visual indications

    document.querySelectorAll(".timer").forEach(function(item) {
        let hareketZamani = item.getAttribute('data-hareket-tarihi');
        let hareketDate = new Date(hareketZamani);
        if (isNaN(hareketDate.getTime())) {
            console.error("Invalid date:", hareketZamani);
            return; // Skip further processing for this item if the date is invalid
        }

        let timerInterval = setInterval(() => {
            let now = new Date().getTime();
            let elapsedTime = (now - hareketDate.getTime()) / 1000; // Calculate elapsed time in seconds

            let hours = Math.floor(elapsedTime / 3600);
            let minutes = Math.floor((elapsedTime % 3600) / 60);

            let halfC = item.querySelector('.halfC');
            let warnC = item.querySelector('.warnC');
            let label = item.querySelector('.base-timer__label');

            if (elapsedTime >= TIME_LIMIT) {
                // If more than 24 hours have passed
                warnC.setAttribute('fill-opacity', '1'); // Show warning visual
                halfC.setAttribute('fill-opacity', '0'); // Optionally, hide the normal state visual
            } else {
                // Less than 24 hours have passed
                halfC.setAttribute('fill-opacity', '1'); // Show normal visual
                warnC.setAttribute('fill-opacity', '0'); // Hide warning visual
            }

            label.textContent = `${hours}s ${minutes}d`; // Update the label with the elapsed time
        }, 1000);
    });
});
</script>

{% endblock %}

{% block javascript %}
  {% include 'adminlte/lib/_scripts.html' %}
  <script src="{% static 'tabulator/dist/js/tabulator.js' %} "></script>

{% endblock %}