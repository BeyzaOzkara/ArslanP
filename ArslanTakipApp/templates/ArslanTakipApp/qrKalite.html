{% extends 'adminlte/base.html' %}
{% block body_class %}{% block bodyclass %}sidebar-collapse {% endblock %}{% endblock %}

{% block title %}Arslan Alüminyum{% endblock %}

{% block content %}
<h1>Arslan Alüminyum</h1>
<h1>~~YAPIM AŞAMASINDA~~</h1>
<h2>{{type}}</h2>
<h2>{{no}}</h2>
<p id="de"></p>
<input type="button" name="deneme" id="btnDeneme" onclick="sendDeneme()">

{% endblock %}

{% block javascript %}

{% include 'adminlte/lib/_scripts.html' %}
<script>
    const socket = new WebSocket('ws://192.168.150.230:8000/ws/notifications/');
    // const socket = new WebSocket(`ws://${window.location.host}/ws/notifications/`);
    console.log(socket);
    console.log("socket altı");

    socket.onopen = function(e) {
        console.log("open")
    }

    socket.onmessage = function(event) {
        const data = JSON.parse(event.data);
        console.log("DATA: ", data);
        document.getElementById('de').innerHTML = data.message;

        if (data.type != "connection_established") {
            const notificationList = document.getElementById('notification-list');
            const nCount = document.getElementById('notification-count');

            // // Update notification count
            console.log(nCount.innerText);
            if (nCount.innerText == "") {nCount.innerText = 0;};
            nCount.innerText = parseInt(nCount.innerText) + 1; //data.message;

            // Add new notification to the list
            const newNotification = document.createElement('a');
            newNotification.classList.add('dropdown-item');
            newNotification.href = '#';
            newNotification.innerHTML = `<i class="fas fa-envelope mr-2"></i> ${data.message}`;
            notificationList.insertBefore(newNotification, data.firstChild);
        }
        
    };

    socket.onclose = function(e) {
        console.log("close")
    };

    function sendDeneme() {
        socket.send(JSON.stringify({
            'message': '4'
        }));
        
        // $.ajax({
        //     url: 'deneme',
        //     method: 'GET',
        //     success: function(response){
        //         console.log(response.message);
        //     },
        //     error: function (error) {
        //     console.error('Error :', error);
        //     }
        // });
    };

</script>
{% endblock %}